<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Developing Assets with Unity </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Developing Assets with Unity ">
    <meta name="generator" content="docfx 2.56.7.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="developing-assets-with-unity">Developing Assets with Unity</h1>

<p>New Assets can be created with Unity and imported into Valheim using Jötunn. A Unity project is included in <a href="https://github.com/Valheim-Modding/JotunnModStub/tree/master/JotunnModUnity">the Jötunn Mod Stub</a>.</p>
<h3 id="software-requirements">Software Requirements</h3>
<p>Creation Tools</p>
<ul>
<li><a href="https://unity3d.com/unity/whats-new/2019.4.20">Unity 2019.4.20</a> - Game engine that Valheim runs in</li>
<li>Visual Studio (installable with Unity) - editor for our plugin code</li>
<li><a href="https://sourceforge.net/projects/utinyripper/files/latest/download">uTinyRipper</a> - tool to rip assets and scripts from the release version of the game</li>
</ul>
<p>Game Mods (install these into your game as our mod has dependencies on them)</p>
<ul>
<li><a href="https://github.com/Valheim-Modding/Jotunn">Jötunn, the Valheim Library</a> - Mod with convenience methods we will use</li>
<li><a href="https://valheim.thunderstore.io/package/ValheimModding/HookGenPatcher/">HookGenPatcher</a> - Patcher that adds convenient hooks to execute our mod code at the right times, that ValheimLib relies on</li>
</ul>
<h2 id="summary-of-steps">Summary of Steps</h2>
<p>To add an item to the game, a mod maker will have to:</p>
<ul>
<li>Create an item asset in Unity</li>
<li>Connect the required Valheim game scripts to the asset so that the game can interact with it</li>
<li>Build the item into an Asset Bundle for importation into the Visual Studio project where they build the mod</li>
<li>Retrieve the asset from the bundle in the mod code</li>
<li>And add that item (and relevant recipes to make it) to the game&#39;s object database when it launches</li>
</ul>
<p>This example is heavily based on <a href="https://github.com/xiaoxiao921/Lead">iDeathHD&#39;s Lead Mod</a>, and has been merged into the new JVL codebase. Please forgive any discrepancies, we are addressing them and converting them where possible.</p>
<h1 id="todo">TODO</h1>
<p>Throughout the code, we will reference code snippets from an example project. That project has a clear example of how to add a new, craftable item to the game with custom assets. You can get that project in its entirety <a href="https://github.com/Valheim-Modding/JotunnModExample">here</a>. You can download that repository and open the Lead.sln file in Visual Studio in order to see the way our mod will be structured.</p>
<h2 id="useful-info-about-valheim-items">Useful Info About Valheim Items</h2>
<p>To add the item into the game, we are going to be utilising various manager and utility methods provided by JVL.</p>
<p><a class="xref" href="../../api/Jotunn.Managers.ItemManager.html#Jotunn_Managers_ItemManager_AddItem_Jotunn_Entities_CustomItem_">ItemManager.Instance.AddItem(CustomItem item)</a> method.
But what is a <code>CustomItem</code> ?</p>
<h3 id="customitem">CustomItem</h3>
<p>A <a class="xref" href="../../api/Jotunn.Entities.CustomItem.html">CustomItem</a> can be instantiated a different number of ways, to facilitate different workflows. In this example we will be providing:</p>
<ul>
<li>A <code>GameObject</code> that will hold a reference to the item prefab. This prefab contains an <code>ItemDrop</code> component.</li>
<li>A <code>bool</code> called FixReferences</li>
</ul>
<p><code>ItemDrop</code> is a class from native valheim, which holds all the needed information for the game to define an item, its name, its functionalities, the text that will show up when hovering it, and so on.</p>
<h2 id="unity-editor-setup">Unity Editor Setup</h2>
<p>Valheim uses Unity Version <strong>2019.4.20</strong></p>
<p>We will want to have two instances of the Unity Editor running, I know that it can be a bit annoying but it&#39;s better for how things will be setup, you&#39;ll see shortly.</p>
<ul>
<li>One unity project that will be made entirely by <a href="https://sourceforge.net/projects/utinyripper/files/latest/download">uTinyRipper</a> (explained below in the <code>Making our Item Prefab</code> chapter)</li>
<li>One <a href="https://github.com/Valheim-Modding/JotunnModStub/tree/master/JotunnModUnity">unity stub project</a> that we will be at first entirely empty, that is made like so</li>
</ul>
<h3 id="unity-stub">Unity Stub</h3>
<ol>
<li><a href="https://public-cdn.cloud.unity3d.com/hub/prod/UnityHubSetup.exe">Download</a> UnityHub directly from Unity or install it with the Visual Studio Installer via <code>Individual Components</code> -&gt; <code>Visual Studio Tools for Unity</code>.</li>
<li>You will need an Unity account to register your PC and get a free licence. Create the account, login with it in Unity Hub and get your licence via <code>Settings</code> -&gt; <code>Licence Management</code>.</li>
<li>Install Unity Editor version 2019.4.20f. <a href="https://unity3d.com/unity/whats-new/2019.4.20">download that and install it</a>.</li>
<li>Open Unity and add the ValheimModUnity project.</li>
<li>Install the <code>AssetBundle Browser</code> package in the Unity Editor via <code>Window</code>-&gt; <code>Package Manager</code>.</li>
<li><p>Copy all <code>assembly_*.dll</code> from <code>&lt;ValheimDir&gt;\valheim_Data\Managed</code> into <code>&lt;ValheimModStub&gt;\ValheimModUnity\Assets\Assemblies</code>.</p>
<p><strong>Copy the assemblies to the new project directly via the filesystem - don&#39;t import the dlls via Unity</strong>.</p>
</li>
</ol>
<p><img src="https://i.imgur.com/yVOLfOa.png" alt="Game Assemblies"> <img src="https://i.imgur.com/4Zun1yU.png" alt="Assemblies Folder"></p>
<ol>
<li>Go back to the Unity Editor and press <code>Ctrl+R</code>. This should reload all files and add the Valheim assemblies under <code>Assets\Assemblies</code></li>
</ol>
<h2 id="making-our-item-prefab">Making our Item Prefab</h2>
<p>Now we want to make a prefab that is setup similarly as the item prefabs that IronGate did, for that, what&#39;s best than looking directly at one of them.</p>
<p>If you haven&#39;t already used <code>uTinyRipper</code> on the game folder to get the prefabs showing up in the ripped game unity project, please do so.</p>
<p>A tutorial is available <a href="https://github.com/Valheim-Modding/Wiki/wiki/Valheim-Unity-Project-Guide">here</a> (You only need to follow it up to the ILSpy part which is optional for what we do here)</p>
<p>Let&#39;s open the <code>SpearChitin</code> prefab as an example.
Should get something like this after opening it</p>
<p><img src="https://i.imgur.com/taWzwlK.png" alt="Assemblies Folder"></p>
<p>As you can see, the root GameObject has multiple components.</p>
<ul>
<li>A rigidbody, for collision handling</li>
<li>ZNetView for making the prefab network compatible</li>
<li>ZSyncTransform, same as above</li>
<li>ItemDrop</li>
</ul>
<p>The last one holds the most interesting stuff, what&#39;s above <code>Shared</code> is non-important and is used for an actual item once its spawned, the meta-data we want to edit is stored under <code>SharedData</code>, so let&#39;s focus on that.</p>
<p>Since there is a stupid amount of fields, let&#39;s go over the one that I edited for my custom item <a href="https://github.com/xiaoxiao921/Lead">Lead</a></p>
<p>I chose this prefab as a base because almost everything is copied from it, except that I remove the model because its not a spear and remove a child on the projectile prefab that we&#39;ll see soon.</p>
<ul>
<li><p>The name: as you can see its a token that is prefixed with <code>$</code> . This dollar signifies this is a token due for replacement by localised content. In my case I changed the name to <code>$custom_item_lead</code></p>
</li>
<li><p><code>Icons</code> : Its an array that is the same size as the number of variant you&#39;ll want for you item, if there is only 1 variant, have a single entry in there and drag and drop your 2D Sprite at the Element 0 field.</p>
</li>
<li><p>Description Token: same thing for the name, mine is <code>$custom_item_lead_description</code></p>
</li>
<li><p><code>Damages</code>: my item was dealing no damage and had no scaling per level so everything was set to 0.</p>
</li>
<li><p><code>Attack Status Effect</code>: Status Effect can be used for items, the chitin spear has the Harpooned Status Effect for, well, harpooning stuff.</p>
</li>
</ul>
<h2 id="porting-the-asset">Porting the asset</h2>
<p>Port the item into the new stubbed unity project, with ALL linked assets (mesh, texture, sound, material, etc). This will be the project from which we make the Asset Bundle to package with our plugin. When you import it, if your script references break, re-apply them and ensure your fields are populated with the desired data.</p>
<p>Before we actually create our bundle, though, you might be wondering - how am I gonna reference game assets in my Unity Project?
If I were to copy paste those, I&#39;d need to fix shaders, and now I&#39;d also have to be worried about copyright infringement, bad.</p>
<p>The solution is easy though, thanks to <a href="https://github.com/Valheim-Modding/Jotunn">JVL</a>, we introduce a <a href="mocks.html">Mock object system</a>. Click the link to learn more about resolving native asset references at runtime.</p>
<h2 id="assetbundle">AssetBundle</h2>
<p>Now we want to make our AssetBundle so that we later inject it with our BepinEx plugin dll</p>
<p>Let&#39;s create an Asset Label for the AssetBundle that we&#39;ll call <code>item_lead</code></p>
<p><img src="https://i.imgur.com/RYZN76Q.png" alt="AssetBundle Label"></p>
<p>Now, let&#39;s use the <code>AssetBundle Browser</code> made by Unity to create our AssetBundle.</p>
<p>Window -&gt; AssetBundle Browser -&gt; Build Tab -&gt; Build</p>
<p><img src="https://i.imgur.com/cdkn6sl.png" alt="Click Build"></p>
<p>We now want to put our AssetBundle in the BepinEx plugin so that we can later inject it.</p>
<p><img src="https://i.imgur.com/495W7UL.png" alt="Freshly made AB"></p>
<h2 id="implementing-your-asset-ingame-using-jvl">Implementing your asset ingame using JVL</h2>
<p>If you have not done so yet, please ensure you have completed the <a href="../getting-started.html">relevant visual studio setup</a>.
You can then follow the <a href="assets.html">Asset importing guide</a>, <a href="items.html">Item Creation</a>, and <a href="localization.html">Localization</a> tutorials.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/Valheim-Modding/Jotunn/blob/51c9fcf56710516661c2146effdf62ea682045c9/JotunnLib/Documentation/tutorials/data/unity.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
